---
layout: post
title:  "Spring 취약점"
tags: Spring web
---
# SpriungBoot

springbnoot는 spring framework에서 복잡한 설정 없이 쉽고 빠르게 만들어주는 `라이브러리` 입니다.

## Spring4Shell

JDK9 버전 이상에서 실행되는 Spring MVC 또는 WebFlux 애플리케이션에서 데이터 바인딩을 통한 원격 코드 실행 취약점입니다.

영향을 받는 버전은 Spring Framework 5.3.0 ~ 5.3.17, 5.20 ~ 5.2.19 및 이전 버전입니다.

취약점 조건은 아래와 같습니다. 5가지의 조건을 모두 만족해야 합니다.

- JDK 9 이상을 사용하는 경우
- Spring Framework 5.3.0 ~ 5.3.17, 5.20 ~ 5.2.19 및 이전 버전을 사용하는 경우
- 아파치 톰캣을 사용하는 경우
- 프로젝트가 WAR로 패키징 되어 있을 경우
- Spring-WebMVC 또는 Spring-WebFlux를 사용하는 경우

## Thymeleaf SSTI

공격자가 원하는 template path를 입력 할 수 있는 경우 template engine(ThymeleafView)은 template path에 대해서 Thymeleaf 표현식을 처리하는 과정을 거치게 되고 이 과정에서 공격자가 입력한 데이터 중 template engine이 해석하는 템플릿 구문에 의해 SSTI가 가능합니다.

- 참고([https://www.acunetix.com/blog/web-security-zone/exploiting-ssti-in-thymeleaf/](https://www.acunetix.com/blog/web-security-zone/exploiting-ssti-in-thymeleaf/))

## Commons-FileUpload 라이브러리(WAF Bypass)

jsp & spring framework로 구현된 웹 서비스에서 파일 업로드 구현 시 가장 흔하게 사용되는 `commons-fileupload` 모듈입니다.

WAF에서 확장자를 검사하는 경우 확장자를 우회하는 공격이 가능한 기법입니다.

commons-fileupload는 1.3 버전 부터 RFC2047를 지원하는데. none ascii text에 대해서 인코딩 방식을 요청자가 지정해서 인코딩하여 전송하고, 응답자는 이를 디코딩해서 해석한다는 내용이 존재합니다.

인코딩은 평문과 Base64를 지원하고 있는데.. 이를 통해서 .jsp와 같은 문구를 잡아내는 WAF를 우회할 수 있게 됩니다.

```java
=?UTF8?B?c29tZV93ZWJzaGVsbC5qc3A=?=.jpg
```
위와 같은 형식으로 인코딩 영역이 끝난 부분에 .jpg를 삽입하게 되면 실제 jsp에서 파일명을 파싱할 시 이부분이 무시 될 수 있습니다.
