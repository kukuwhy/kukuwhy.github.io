# Nmap2Excel

Created: 2021ë…„ 11ì›” 24ì¼ ì˜¤í›„ 10:24
Tags: excel, network

### 0. ê°œìš”

ëª¨ì˜ì¹¨íˆ¬ í”„ë¡œì íŠ¸ ì§„í–‰ ì‹œ ë³´í†µ ë¸”ë™ë°•ìŠ¤ë¡œ íŠ¹ì • ëŒ€ìƒì—†ì´ ì§„í–‰í•˜ê¸° ë•Œë¬¸ì— ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­ëŒ€ ìŠ¤ìº”ì„ í†µí•´ ì¹¨íˆ¬ í¬ì¸íŠ¸ë¥¼ ë§ì´ ì°¾ê²Œ ë©ë‹ˆë‹¤.  ë„¤íŠ¸ì›Œí¬ ìŠ¤ìº” ì§„í–‰ ì‹œ ë³´í†µ ê³ ê°ì‚¬ì—ì„œë„ ìŠ¤ìº” ê²°ê³¼ë¥¼ í•¨ê»˜ ìš”êµ¬í•˜ê¸° ë•Œë¬¸ì— ë§¤ë²ˆ nmap ìŠ¤ìº” ê²°ê³¼ë¥¼ ì—‘ì…€ë¡œ ì •ë¦¬í•´ì•¼ í–ˆê³  ëŒ€ì—­ëŒ€ë‚˜ ì—´ë¦° í¬íŠ¸ê°€ ë§ì„ ê²½ìš° ì •ë¦¬í•˜ëŠ” ì‹œê°„ì´ ë„ˆë¬´ ì˜¤ë˜ ê±¸ë¦¬ê³  ì—¬ê°„ ê·€ì°®ì€ê²Œ ì•„ë‹ˆë¼.. ìë™í™”ë¥¼ ì§„í–‰í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤ğŸ˜‚

Nmapì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ XML í˜•ì‹ìœ¼ë¡œ ì•„ì›ƒí’‹ ë°ì´í„°ë¥¼ ì¶œë ¥í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— Nmapì„ ì‹¤í–‰í•˜ê³  ì¶œë ¥ëœ XMLì„ íŒŒì‹±í•´ì„œ ì—‘ì…€ë¡œ ë³€í™˜í•´ì£¼ë„ë¡ ê°œë°œí–ˆìŠµë‹ˆë‹¤. ì—‘ì…€ ì–‘ì‹ì€ ê¸°ë³¸ì ìœ¼ë¡œ ì‹¤ì œ í”„ë¡œì íŠ¸ ì§„í–‰ ì‹œ ê³ ê°ì‚¬ì—ê²Œ ì œê³µë˜ëŠ” ì–‘ì‹ìœ¼ë¡œ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.

![Nmap2Excel%20ac934e5d56804f748fe162c4795c0656/Untitled.png](Nmap2Excel%20ac934e5d56804f748fe162c4795c0656/Untitled.png)

ìë™ìœ¼ë¡œ ì—‘ì…€ë¡œ ì‘ì„±ë˜ë©´ ìˆ˜ë™ ì ê²€ì„ í†µí•´ ì ‘ê·¼ ë° ì¸ì¦ì—¬ë¶€ë¥¼ íŒŒì•…í•˜ê³  ì„¸ë¶€ì ì¸ ë‚´ìš©ì„ ê¸°ìˆ  í•  ìˆ˜ ìˆëŠ” ì–‘ì‹ì…ë‹ˆë‹¤.

ìµœëŒ€í•œ ì‚¬ìš©ì„±ì„ ê³ ë ¤í•´ì„œ Nmapì„ ì‚¬ìš©í•˜ë“¯ system argumentë¡œ ë™ì¼í•˜ê²Œ ì¸ì ê°’ì„ ì „ë‹¬í•˜ë©´ ìë™ìœ¼ë¡œ ì™„ì„±í•´ì¤ë‹ˆë‹¤. 

### 1. ì‚¬ìš©ë²•

```java
#requirements.txtì„ í†µí•´ í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
pip install -r requirements.txt

nmap2excel.py <Nmap ëª…ë ¹ì–´ êµ¬ë¬¸>
ex) 
nmap2excel.py -sV 127.0.0.1
nmap2excel.py -sV 127.0.0.1 1.1.1.1
nmap2excel.py -sS 127.0.0.0/24 -p80,8080
```

### 2. ê²°ê³¼

![Nmap2Excel%20ac934e5d56804f748fe162c4795c0656/Untitled%201.png](Nmap2Excel%20ac934e5d56804f748fe162c4795c0656/Untitled%201.png)

### 3. Code

```python
import xml.etree.ElementTree as elemTree
import openpyxl
from openpyxl.styles import *
import sys
import os
import datetime

#XML ê°ì²´í™”
def getXML():
    count = 1
    #ì—‘ì…€ ìƒì„±
    wb = createExcel()
    ws = wb.active

    thin_border = Border(left=Side(style='thin'),
                         right=Side(style='thin'),
                         top=Side(style='thin'),
                         bottom=Side(style='thin'))

    tree = elemTree.parse(now_date+'.xml')
    #host ë°˜ë³µë¬¸
    for host in tree.findall('./host'):
        #adrress
        addrNumber = host.find('address').attrib['addr']
        addrArray = addrNumber.split('.')
        addrArray[3] = '0'
        addrBand = '.'.join(addrArray)

        print("[+] address list : " + addrNumber)
        #port ë°˜ë³µë¬¸
        for port in host.iter('port'):
            state = port.find('state')
            service = port.find('service')

            if state.attrib['state'] == "open":

                stateText = state.attrib['state']
                portNumber = port.attrib['portid']
                serviceName = service.attrib['name']
                #ê°’ ìœ íš¨ì„± ê²€ì‚¬ í›„ ì§„í–‰
                product = service.attrib['product'] if 'product' in service.attrib else ""
                version = service.attrib['version'] if 'version' in service.attrib else ""
                extraInfo = service.attrib['extrainfo'] if 'extrainfo' in service.attrib else ""

                serviceVersion = product + "" + version + "" + extraInfo
                cellCount = count+5
                #ì—‘ì…€ ê¸°ë¡ êµ¬ê°„
                ws['B'+str(cellCount)] = count
                ws['C'+str(cellCount)] = addrBand
                ws['D' + str(cellCount)] = addrNumber
                ws['E' + str(cellCount)] = int(portNumber)
                ws['F' + str(cellCount)] = stateText
                ws['G' + str(cellCount)] = serviceName
                ws['H' + str(cellCount)] = serviceVersion
                count = count+1

    for rng in ws['B4:K'+str(count+4)]:
        for cell in rng:
            cell.border = thin_border
    wb.save(now_date+'.xlsx')

#ì—‘ì…€ ë§Œë“¬
def createExcel():
    wb = openpyxl.Workbook()
    #í™œì„±í™” ëœ ì‹œíŠ¸
    ws = wb.active
    ws.title = 'Nmap Port Scan'
    for rng in ws['A1:K999']:
        for cell in rng:
            cell.alignment = Alignment(vertical='center', horizontal='center')

    double_border = Border(left=Side(style='double'),
                         right=Side(style='double'),
                         top=Side(style='double'),
                         bottom=Side(style='double'))
    white_font = Font(color='ffffff', bold=True)
    bold_font = Font(bold=True)
    #ì—´ ë„ˆë¹„ ì„¤ì •
    ws.column_dimensions['A'].width = 2
    ws.column_dimensions['B'].width = 5.8
    ws.column_dimensions['C'].width = 14.4
    ws.column_dimensions['D'].width = 14.4
    ws.column_dimensions['E'].width = 10.3
    ws.column_dimensions['F'].width = 8.1
    ws.column_dimensions['G'].width = 15.5
    ws.column_dimensions['H'].width = 46.5
    ws.column_dimensions['I'].width = 9.3
    ws.column_dimensions['J'].width = 10.3
    ws.column_dimensions['K'].width = 35

    #í‹€ ë‚´ìš© ì…ë ¥
    ws['B5'] = 'NO'
    ws['C5'] = 'ëŒ€ì—­ëŒ€'
    ws['D5'] = 'IP'
    ws['E5'] = 'port'
    ws['F5'] = 'status'
    ws['G5'] = 'service'
    ws['H5'] = 'ì •ë³´'
    ws['I5'] = 'ì ‘ê·¼ì—¬ë¶€'
    ws['J5'] = 'ì¸ì¦ì—¬ë¶€'
    ws['K5'] = 'ë‚´ìš©'

    #ë¬¸ì„œ ì œëª© ë¶€ë¶„
    ws.merge_cells('B2:K2')
    ws['B2'] = "{ê³ ê°ì‚¬ëª…} ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­ëŒ€ ìŠ¤ìº” ê²°ê³¼"
    ws['B2'].font = Font(size=16)

    for celli in ws['B2:K2'] :
        for cellj in celli :
            cellj.border = double_border

    #ë¬¸ì„œ ì†ì„± ë¶€ë¶„
    ws.merge_cells('B4:D4')
    ws['B4'] = "ìì‚°ì •ë³´"
    ws['B4'].fill = PatternFill("solid", fgColor='C0504D')
    ws['B5'].fill = PatternFill("solid", fgColor='F2DCDB')
    ws['C5'].fill = PatternFill("solid", fgColor='F2DCDB')
    ws['D5'].fill = PatternFill("solid", fgColor='F2DCDB')

    ws['B4'].font = white_font
    ws['B5'].font = bold_font
    ws['C5'].font = bold_font
    ws['D5'].font = bold_font

    ws.merge_cells('E4:G4')
    ws['E4'] = "Portì •ë³´"
    ws['E4'].fill = PatternFill("solid", fgColor='4F81BD')
    ws['E5'].fill = PatternFill("solid", fgColor='DCE6F1')
    ws['F5'].fill = PatternFill("solid", fgColor='DCE6F1')
    ws['G5'].fill = PatternFill("solid", fgColor='DCE6F1')

    ws['E4'].font = white_font
    ws['E5'].font = bold_font
    ws['F5'].font = bold_font
    ws['G5'].font = bold_font

    ws.merge_cells('H4:K4')
    ws['H4'] = "ë¶„ì„ì •ë³´"
    ws['H4'].fill = PatternFill("solid", fgColor='F79646')
    ws['H5'].fill = PatternFill("solid", fgColor='FCD5B4')
    ws['I5'].fill = PatternFill("solid", fgColor='FCD5B4')
    ws['J5'].fill = PatternFill("solid", fgColor='FCD5B4')
    ws['K5'].fill = PatternFill("solid", fgColor='FCD5B4')

    ws['H4'].font = white_font
    ws['H5'].font = bold_font
    ws['I5'].font = bold_font
    ws['J5'].font = bold_font
    ws['K5'].font = bold_font

    return wb

#Nmap ì‹¤í–‰ ì˜¤ë˜ê±¸ë¦¼.
def getNmap(arg):
    command = "".join(["nmap ",arg," -oX "+ now_date +".xml"])
    print("[*] nmap command : " + command)
    process = os.popen(command)
    results = str(process.read())
    return results

count = 10
now = datetime.datetime.now()
now_date = now.strftime('%Y-%m-%d_%H-%M-%S')
arg = ' '.join(sys.argv[1:len(sys.argv)])

print("[+] Nmap Start ")
getNmap(arg)
print("[+] XML to Excel! end soon")
getXML()
print("[+] END ")
```